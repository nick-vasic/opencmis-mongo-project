<project name="Mongo Installation" default="createdb" basedir=".">
	<description>
		Set up MongoDB environment
	</description>
	<!-- set global properties for this build -->
	<property name="dist" location="mongo" />
	<property name="mongo-version" value="mongodb-osx-x86_64-2.6.6"/> 

	<target name="check-download">
    	<available file="${dist}/download/${mongo-version}.tgz" 
    		property="download.present"/>
	</target>
	 
	<target name="download" depends="check-download" unless="download.present">
		<mkdir dir="${dist}/download" />
		<get src="http://downloads.mongodb.org/osx/${mongo-version}.tgz"
			dest="${dist}/download/${mongo-version}.tgz">
		</get>
	</target>
	


	<target name="extract" depends="download">
		
		<mkdir dir="${dist}/binaries" />
		<mkdir dir="${dist}/extract" />

		<untar src="${dist}/download/${mongo-version}.tgz" dest="${dist}/extract/"
			compression="gzip" />

		<copy todir="${dist}/binaries">
			<fileset dir="${dist}/extract/${mongo-version}/bin">
			</fileset>
		</copy>
		<chmod dir="${dist}/binaries" perm="ugo+rx" includes="**/*"/>
		<delete dir="${dist}/extract" />
	</target>

	<target name="createdb">
		<mkdir dir="${dist}/data" />
		
  		<exec executable="${dist}/binaries/mongod" spawn="true">
  			<arg line="--dbpath ${dist}/data"/>
  		</exec>
	</target>
	
	<target name="generate-test-data">
		<mkdir dir="${dist}/data" />
		
  		<exec executable="${dist}/binaries/mongo" spawn="false">
  			<arg line="${dist}/scripts/generate-test-data.js"/>
  		</exec>
	</target>

	<target name="clean-data" description="clean up">
		<delete dir="${dist}/data" />
	</target>
	
	<target name="clean-all" description="clean up everything">
		<delete dir="${dist}/data" />
		<delete dir="${dist}/binaries" />
		<delete dir="${dist}/extract" />
	</target>
</project>